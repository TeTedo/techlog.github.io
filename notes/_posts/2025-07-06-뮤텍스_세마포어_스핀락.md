---
title: "스핀락, 뮤텍스, 세마포어 비교"
date: 2025-07-06
categories: [OS, 동시성, 동기화]
tags: [스핀락, 뮤텍스, 세마포어, 동시성, 락, 동기화, 레이스컨디션]
---

# 스핀락(spinlock) 뮤텍스(mutex) 세마포(semaphore) 특징

## 목차

1. [개요](#1-개요)
2. [레이스 컨디션과 동시성 문제](#2-레이스-컨디션과-동시성-문제)
3. [락(Lock)의 기본 원리 및 Test-and-Set 함수](#3-락lock의-기본-원리-및-test-and-set-함수)
4. [스핀락(Spinlock)의 이해와 한계](#4-스핀락spinlock의-이해와-한계)
5. [뮤텍스(Mutex)의 개념 및 동작 방식](#5-뮤텍스mutex의-개념-및-동작-방식)
6. [세마포어(Semaphore)의 개념 및 활용](#6-세마포어semaphore의-개념-및-활용)
7. [뮤텍스와 세마포어의 주요 차이점](#7-뮤텍스와-세마포어의-주요-차이점)
8. [우선순위 역전과 뮤텍스의 해결책](#8-우선순위-역전priority-inversion과-뮤텍스의-해결책)
9. [결론 및 추가 고려사항](#9-결론-및-추가-고려사항)

## 동시성 제어: 레이스 컨디션, 락, 뮤텍스, 세마포어

멀티 스레드 및 멀티프로세스 환경에서 발생하는 동시성문제와 이를 해결하기 위한 다양한 동기화 기법들을 다룹니다. 레이스 컨디션의 이해부터 락(Lock), 스핀락(Spinlock), 뮤텍스(Mutex), 세마포어(Semaphore)의 원리 및 활용

## 1. 개요

동시성제어는 여러 프로세스나 스레드가 공유 자원에 동시에 접근할 때 데이터의 일관성을 유지하고 예기치 않은 오류를 방지하기 위한 핵심 개념이다.

- **레이스 컨디션 (Race Condition)**: 여러 프로세스나 스레드가 동시에 데이터를 조작할 때, 타이밍이나 접근 순서에 따라 결과가 달라지는 상황을 의미한다.
- **공유와 보호**: 여러 프로세스나 스레드를 동시에 실행하더라도 공유 데이터의 일관성을 유지하는 것을 목표로 함.
- **크리티컬 섹션 (Critical Section)**: 공유 데이터의 일관성을 보장하기 위해 단 하나의 프로세스나 스레드만 진입하여 실행할 수 있는 영역이다.

## 2. 레이스 컨디션과 동시성 문제

레이스 컨디션은 여러 스레드가 공유 데이터를 동시에 조작할 때 발생하며, 이는 예측 불가능한 결과를 초래할 수 있다. 예를 들어, 두 스레드가 동시에 변수 x를 1씩 증가시키는 작업을 수행할 경우, 최종 x의 값이 예상과 다를 수 있다. 이러한 문제를 해결하고 공유 데이터의 일관성을 유지하기 위해서는 적절한 보호 메커니즘이 필요하며, 크리티컬 섹션은 이러한 보호가 필요한 코드 영역을 지정하는 방법이다.

## 3. 락(Lock)의 기본 원리 및 Test-and-Set 함수

공유 데이터의 일관성을 보장하기 위한 가장 기본적인 방법은 **락(Lock)을 사용하는 것이다**. 락은 크리티컬 섹션에 진입하려는 프로세스나 스레드가 경쟁하여 획득하며, 락을 획득한 스레드만이 크리티컬 섹션을 실행할 수 있다.

- **락 획득 및 방출**: 락을 획득한 스레드는 작업을 마친 후 락을 방출하여 다른 스레드가 크리티컬 섹션에 진입할 수 있도록 한다.
- **Test-and-Set 함수**: 락구현의 핵심이 되는 Test-and-Set 함수는 다음의 기능을 수행한다. 공유되는 락의 현재 값을 가져와 반환한다. 값을 반환하기 직전에 락의 값을 무조건 1로 변경한다. CPU의 Atomic 명령어 지원을 받아 실행 중간에 간섭받거나 중단되지 않으며, 같은 메모리 영역에 대해 동시에 실행되지 않도록 보장한다.

```bash
function test_and_set(lock) {
  old_value = lock
  lock = 1
  return old_value
}
```

```bash
while test_and_set(lock) == 1:
  wait
# 락을 획득함
```

## 4. 스핀락(Spinlock)의 이해와 한계

스핀락은 락을 획득할 때까지 반복적으로 대기(spinning)하는 방식의 동기화 기법이다.

- **동작 방식**: 락을 획득하려는 스레드는 Test-and-Set 함수를 반복적으로 호출하여 락의 상태를 확인한다. 락이 해제되면 즉시 획득하고 크리티컬 섹션에 진입한다.
- **스핀락의 단점**: 락을 기다리는 동안 CPU를 계속 낭비한다는 단점이 있다. 이는 대기하는 동안에도 CPU 사이클을 소모하기 때문이다.
- **멀티코어 환경에서의 이점**: 싱글 코어 환경에서는 컨텍스트 스위칭이 필요하여 스핀락의 이점이 없지만, 멀티코어 환경에서는 하나의 코어가 락을 기다리는 동안 다른 코어에서 락을 획득한 스레드가 작업을 수행할 수 있다. 크리티컬 섹션내부의 작업량이 컨텍스트 스위칭비용보다 적을 경우, 스핀락이 뮤텍스보다 효율적일 수 있음.

## 5. 뮤텍스(Mutex)의 개념 및 동작 방식

뮤텍스는 스핀락의 CPU 낭비 단점을 보완하기 위해 고안된 동기화 기법이다. 락을 획득할 수 없을 때 스레드를 대기 상태로 전환하여 CPU 사이클 낭비를 최소화한다.

- **동작 방식**:스레드가 락획득에 실패하면, 해당 스레드는 큐에 들어가 대기 상태가 되는데, 락을 가진 스레드가 크리티컬 섹션작업을 완료하여 락을 반환하면 대기 중인 스레드중 하나를 깨워 락을 획득하도록 한다. 뮤텍스도 내부적으로 CPU의 Atomic 명령어를 사용하여 안전하게 락상태를 변경한다.
- **주요 특징**: 뮤텍스는 **락을 가진 스레드만이 락을 해제할 수 있다**는 중요한 특징을 가집니다.

## 6. 세마포어(Semaphore)의 개념 및 활용

세마포어는 시그널 메커니즘을 통해 하나 이상의 프로세스나 스레드가 크리티컬 섹션에 접근 가능하도록 하는 장치이다.

- **뮤텍스와의 차이점**: 뮤텍스는 단 하나의 스레드만 크리티컬 섹션에 진입할 수 있지만, 세마포어는 여러 스레드가 동시에 진입할 수 있도록 허용할 수 있다.

**종류**

- **바이너리 세마포어 (Binary Semaphore)**: value 값이 0 또는 1만 가질 수 있으며, 뮤텍스와 유사하게 동작하여 하나의 스레드만 크리티컬 섹션에 접근을 허용한다.

- **카운팅 세마포어 (Counting Semaphore)**: value 값이 1보다 큰 값을 가질 수 있으며, 설정된 value 값만큼의 스레드가 동시에 크리티컬 섹션에 진입할 수 있도록 한다. (예: 공중 화장실의 좌변기 개수)

- **시그널 메커니즘**: 세마포어의 가장 큰 특징 중 하나는 시그널 메커니즘을 통해 작업 순서를 동기화할 수 있다는 점이다. 특정 작업이 완료되면 signal을 호출하여 다른 대기 중인 작업을 깨울 수 있다. wait를 호출하여 특정 signal이 발생할 때까지 대기할 수 있다. wait와 signal 호출 주체가 반드시 동일한 스레드일 필요가 없습니다.

## 7. 뮤텍스와 세마포어의 주요 차이점

**락 해제 주체**

- 뮤텍스: 락을 획득한 스레드만이 락을 해제할 수 있다.
- 세마포어: 락을 획득하지 않은 스레드도 signal을 통해 락을 해제(값 증가)할 수 있다. (wait와 signal의 주체가 다를 수 있음)
  **소속**
  뮤텍스: 락을 획득한 스레드에 소속되며 락을 해제할 스레드를 예측할 수 있다.
  세마포어: 특정 스레드에 소속되지 않는다.

## 8. 우선순위 역전(Priority Inversion)과 뮤텍스의 해결책

우선순위 역전은 우선순위 기반 스케줄링 환경에서 우선순위가 높은 스레드가 낮은 스레드에 의해 블록되는 현상을 의미한다.

- **문제**: 우선순위가 낮은 스레드가 공유 락을 획득한 상태에서 높은 우선순위의 스레드가 해당 락을 요청하면, 낮은 우선순위 스레드가 락을 해제할 때까지 높은 우선순위 스레드가 대기하게 됩니다. 이때 낮은 우선순위 스레드가 다른 중간 우선순위 스레드에 의해 선점될 경우, 높은 우선순위 스레드의 대기 시간이 불필요하게 길어질 수 있다.
- **뮤텍스의 해결책**: 뮤텍스는 **우선순위 상속 (Priority Inheritance)** 속성을 통해 이 문제를 해결하는데,높은 우선순위 스레드가 낮은 우선순위 스레드가 가진 락을 기다릴 때, 낮은 우선순위 스레드의 우선순위를 일시적으로 높은 우선순위 스레드의 우선순위만큼 끌어올려 빨리 작업을 완료하고 락을 해제하도록 한다.
- **세마포어의 한계**: 세마포어는 누가 락을 해제할지 알 수 없으므로 우선순위 상속 속성을 지원하지 않음.

## 9. 결론 및 추가 고려사항

스핀락, 뮤텍스, 세마포어는 각각의 장단점과 사용 시나리오를 가집니다.

- **스핀락**: 크리티컬 섹션의 작업이 짧고 컨텍스트 스위칭비용보다 빠르게 끝나는 멀티코어 환경에 적합하다.
- **뮤텍스**: 락획득 실패 시 스레드를 대기시켜 CPU 낭비를 줄이며, 우선순위 역전 문제 해결에 유리한다. 하나의 스레드만 진입 가능한 상호 배제가 필요할 때 적합하다.
- **세마포어**: 여러 스레드가 동시에 접근할 수 있는 자원 관리나, 작업 간의 순서 동기화(시그널 메커니즘)가 필요할 때 유용하다.

# References

- https://www.youtube.com/watch?v=gTkvX2Awj6g&t=179s
